{"version":3,"file":"store-BcfelaBj.js","sources":["../../../.svelte-kit/adapter-node/chunks/store.js"],"sourcesContent":["import { d as db } from \"./db.js\";\nasync function getStoreByMember(memberId) {\n  const res = await db.query(\n    \"select * from mt_store s left join mt_store_info msi on msi.id_store = s.id where id_member = $1\",\n    [memberId]\n  );\n  return res?.rows[0] ?? null;\n}\nasync function createStore(data) {\n  try {\n    const res = await db.query(\n      \"insert into mt_store (id_member, name, description, email, phone, domain) values ($1, $2, $3, $4, $5, $6) returning id\",\n      [data.memberId, data.name, data.description, data.email, data.phone, data.domain]\n    );\n    if (res && res?.rows.length > 0) {\n      await db.query(\"insert into mt_fee set id_member = $1, fee_member = 300\", [data.memberId]);\n    }\n    return {\n      error: null,\n      data: res?.rows[0] ?? null\n    };\n  } catch (error) {\n    console.log(error);\n    if (error.code == 23505) {\n      return {\n        error: \"Domain sudah terdaftar\",\n        data: null\n      };\n    }\n    return {\n      error: \"Terjadi kesalahan\",\n      data: null\n    };\n  }\n}\nasync function updateStore(params) {\n  try {\n    const queryParams = [\n      params.memberId,\n      params.name,\n      params.description,\n      params.email,\n      params.phone,\n      params.theme,\n      params.color\n    ];\n    let setLogo = \"\";\n    if (params.logo) {\n      setLogo = \", logo = $8\";\n      queryParams.push(params.logo);\n    }\n    const query = `update mt_store set name = $2, description = $3, email = $4, phone = $5, theme = $6, color = $7 ${setLogo} where id_member = $1 returning id`;\n    const res = await db.query(query, queryParams);\n    return {\n      error: null,\n      data: res?.rows[0] ?? null\n    };\n  } catch (error) {\n    console.log(error);\n    return {\n      error: \"Terjadi kesalahan\",\n      data: null\n    };\n  }\n}\nasync function updateStoreInfo(params) {\n  try {\n    const store = await db.query(\"select id from mt_store where id_member = $1\", [params.memberId]);\n    const storeId = store?.rows[0].id;\n    let result;\n    result = await db.query(\n      `update mt_store_info set tiktok = $2, fb = $3, ig = $4, twitter = $5, telegram = $6 where id_store = $1 returning id;`,\n      [storeId, params.tiktok, params.fb, params.ig, params.twitter, params.telegram]\n    );\n    if (!result?.rows || result?.rows.length <= 0) {\n      result = await db.query(\n        `insert into mt_store_info (id_store, tiktok, fb, ig, twitter, telegram) values ($1, $2, $3, $4, $5, $6);`,\n        [storeId, params.tiktok, params.fb, params.ig, params.twitter, params.telegram]\n      );\n    }\n    return {\n      error: null,\n      data: result?.rows[0] ?? null\n    };\n  } catch (error) {\n    console.log(error);\n    return {\n      error: \"Terjadi kesalahan\",\n      data: null\n    };\n  }\n}\nasync function getStoreByDomain(host) {\n  if (host == \"localhost\") {\n    host = \"www.kingplay.id\";\n  }\n  const res = await db.query(\n    \"select * from mt_store ms left join mt_store_info msi on msi.id_store = ms.id where domain = $1 or custom_domain = $1 limit 1\",\n    [host]\n  );\n  return res?.rows[0] ?? null;\n}\nasync function getAllProduct() {\n  const res = await db.query(\n    \"select mp.id_produk, mp.produk, mp.hpp, mgp.nama_group_produk from mt_produk mp left join mt_group_produk mgp on mgp.id_group_produk = mp.id_group_produk order by nama_group_produk asc, hpp asc, produk asc\",\n    []\n  );\n  return res?.rows ?? [];\n}\nasync function getMemberFees(memberId) {\n  const resFee = await db.query(`select mf.fee_member from mt_fee mf where mf.id_member = $1`, [\n    memberId\n  ]);\n  const resFeeCustom = await db.query(\n    `select mfc.*, mp.produk, mgp.nama_group_produk from mt_fee_custom mfc \n\t\t\tleft join mt_produk mp on mp.id_produk = mfc.id_produk \n\t\t\tleft join mt_group_produk mgp on mgp.id_group_produk = mp.id_group_produk \n\t\twhere mfc.id_member = $1`,\n    [memberId]\n  );\n  return {\n    defaultFee: resFee?.rows[0]?.fee_member ?? 0,\n    fees: resFeeCustom?.rows ?? []\n  };\n}\nasync function setFeeDefault(params) {\n  try {\n    let result;\n    result = await db.query(\n      `update mt_fee set fee_member = $2 where id_member = $1 returning id_member;`,\n      [params.memberId, params.amount]\n    );\n    if (!result?.rows || result?.rows.length <= 0) {\n      result = await db.query(\n        `insert into mt_fee (id_member, fee_member) values ($1, $2) returning id_member;`,\n        [params.memberId, params.amount]\n      );\n    }\n    return {\n      error: null,\n      data: result?.rows[0] ?? null\n    };\n  } catch (error) {\n    console.log(error);\n    return {\n      error: \"Terjadi kesalahan\",\n      data: null\n    };\n  }\n}\nasync function setFee(params) {\n  try {\n    let result;\n    result = await db.query(\n      `update mt_fee_custom set fee_member = $3 where id_member = $1 and id_produk = $2 returning id_member;`,\n      [params.memberId, params.product, params.amount]\n    );\n    if (!result?.rows || result?.rows.length <= 0) {\n      result = await db.query(\n        `insert into mt_fee_custom (id_member, id_produk, fee_member) values ($1, $2, $3) returning id_member;`,\n        [params.memberId, params.product, params.amount]\n      );\n    }\n    return {\n      error: null,\n      data: result?.rows[0] ?? null\n    };\n  } catch (error) {\n    console.log(error);\n    return {\n      error: \"Terjadi kesalahan\",\n      data: null\n    };\n  }\n}\nasync function deleteFee(memberId, productId) {\n  await db.query(\"delete from mt_fee_custom where id_member = $1 and id_produk = $2\", [\n    memberId,\n    productId\n  ]);\n}\nexport {\n  getStoreByMember as a,\n  getMemberFees as b,\n  createStore as c,\n  getAllProduct as d,\n  setFee as e,\n  deleteFee as f,\n  getStoreByDomain as g,\n  updateStoreInfo as h,\n  setFeeDefault as s,\n  updateStore as u\n};\n"],"names":[],"mappings":"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"}