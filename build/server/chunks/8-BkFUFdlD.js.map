{"version":3,"file":"8-BkFUFdlD.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(homepage)/_game_/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/8.js"],"sourcesContent":["import { e as error } from \"../../../../chunks/index.js\";\nimport { d as db } from \"../../../../chunks/db.js\";\nimport { M as MappingGroupChannel } from \"../../../../chunks/constant.js\";\nimport { r as request, a as generateMid } from \"../../../../chunks/request.js\";\nasync function getGameGroupBySlug(slug) {\n  const res = await db.query(\"select * from mt_group_produk mgp where slug = $1 limit 1\", [slug]);\n  return res.rows[0] ?? null;\n}\nasync function getGameField(groupId) {\n  const res = await db.query(\n    \"select * from mt_fields mf where id_group_produk = $1 and is_active = true order by field_order asc\",\n    [groupId]\n  );\n  return res.rows ?? [];\n}\nasync function getPaymentChannels() {\n  const res = await db.query(\"select * from mt_channel_pembayaran\");\n  return res.rows ?? [];\n}\nconst load = async ({ cookies, params, url }) => {\n  const productId = url.searchParams.get(\"product\")?.toString() ?? \"\";\n  const group = await getGameGroupBySlug(params.game);\n  if (!group || !group.id_group_produk) {\n    error(404);\n  }\n  const game = {\n    id: group.id_group_produk,\n    slug: group?.slug ?? \"\",\n    name: group.nama_group_produk,\n    image: group.img,\n    fields: [],\n    itemImg: group.item_img,\n    itemName: group.item_name\n  };\n  const fields = await getGameField(group.id_group_produk);\n  game.fields = fields.map((fld) => ({\n    key: fld.field_name,\n    title: fld.field_title,\n    target: fld.field_target,\n    placeholder: fld.field_placeholder,\n    options: fld.field_options ?? [],\n    type: fld.field_type,\n    required: fld.is_required ?? false\n  }));\n  const userId = cookies.get(\"uuid\") ?? \"\";\n  const { data: dataProducts } = await request({\n    method: \"POST\",\n    endpoint: \"/v1.0/api/produk/list-produk\",\n    payload: { id_group_produk: game.id.toString() },\n    uuid: userId\n  });\n  const products = dataProducts?.map((product) => ({\n    id: product.id_produk,\n    name: product.produk,\n    price: product.nominal,\n    icon: \"\",\n    status: product.status\n  }));\n  let channels = [];\n  let selectedProduct = null;\n  let dataChannels = [];\n  if (productId) {\n    const { data: resChannels } = await request({\n      method: \"POST\",\n      endpoint: \"/v1.0/api/invoices/channel\",\n      payload: { mid: crypto.randomUUID(), id_produk: productId, id_user: userId },\n      uuid: userId\n    });\n    dataChannels = resChannels ?? [];\n    selectedProduct = products.find((val) => val.id == productId) ?? null;\n  } else {\n    dataChannels = await getPaymentChannels();\n  }\n  channels = groupingPaymentChannel(dataChannels);\n  return {\n    game,\n    products,\n    selectedProduct,\n    channels\n  };\n};\nconst actions = {\n  default: async ({ request: req, cookies }) => {\n    const formData = await req.formData();\n    const product = formData.get(\"product\");\n    const idpel1 = formData.get(\"id_pelanggan_1\");\n    const idpel2 = formData.get(\"id_pelanggan_2\");\n    const channel = formData.get(\"channel\");\n    const mid = generateMid();\n    const userId = cookies.get(\"uuid\") ?? \"\";\n    const inquiry = await request({\n      method: \"POST\",\n      endpoint: \"/v1.0/api/inquiry/\",\n      payload: {\n        mid,\n        step: 2,\n        data: {\n          id_produk: product,\n          id_user: userId,\n          id_pelanggan: idpel1 ?? \"\",\n          id_pelanggan2: idpel2 ?? \"\",\n          id_pelanggan3: \"\",\n          email: \"\"\n        }\n      },\n      uuid: userId\n    });\n    const inqAdditional = inquiry?.additional;\n    const idInquiry = inqAdditional?.response_transaction_detail?.id_transaksi_inquiry;\n    if (inquiry.code != \"00\" || !inquiry.data || !idInquiry) {\n      return inquiry;\n    }\n    const invoice = await request({\n      method: \"POST\",\n      endpoint: \"/v1.0/api/invoices/\",\n      payload: {\n        mid,\n        step: 2,\n        data: {\n          id_produk: product,\n          id_user: userId,\n          id_pelanggan1: idpel1 ?? \"\",\n          id_pelanggan2: idpel2 ?? \"\",\n          id_pelanggan3: \"\",\n          email: \"\",\n          phone: \"\"\n        },\n        invoice_detail: {\n          id_channel_pembayaran: channel,\n          id_transaksi_inquiry: idInquiry\n        }\n      },\n      uuid: userId\n    });\n    return invoice;\n  }\n};\nconst groupingPaymentChannel = (data) => {\n  const groupMapping = {};\n  data.forEach((item, idx) => {\n    if (!groupMapping[item.nama_group_channel]) {\n      const group = MappingGroupChannel.find((ch) => ch.group == item.nama_group_channel);\n      groupMapping[item.nama_group_channel] = {\n        id: Object.keys(groupMapping).length + 1,\n        label: group?.name ?? \"\",\n        type: group?.group ?? \"\",\n        channels: [],\n        images: []\n      };\n    }\n    const channel = {\n      id: item.id_channel_pembayaran,\n      code: item.via,\n      image: item.img,\n      name: item.via,\n      price: item.nominal_up_pg ?? \"\",\n      helper: \"<ul><li>Step 1</li><li>Step 2</li></ul>\"\n    };\n    groupMapping[item.nama_group_channel].channels.push(channel);\n    groupMapping[item.nama_group_channel].images.push(item.img);\n  });\n  return Object.values(groupMapping);\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/(homepage)/_game_/_page.server.ts.js';\n\nexport const index = 8;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(homepage)/_game_/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(homepage)/[game]/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/8.Blar0vdi.js\",\"_app/immutable/chunks/scheduler.BBfqLarD.js\",\"_app/immutable/chunks/index.BP6FsQ8L.js\",\"_app/immutable/chunks/each.DxWbBfWu.js\",\"_app/immutable/chunks/index.BWr1KjGO.js\",\"_app/immutable/chunks/SvelteToast.svelte_svelte_type_style_lang.yrqkKXpK.js\",\"_app/immutable/chunks/index.CKUPByak.js\",\"_app/immutable/chunks/forms.DgphUJD1.js\",\"_app/immutable/chunks/entry.BDPKqPHQ.js\",\"_app/immutable/chunks/stores.D2EpS8_z.js\",\"_app/immutable/chunks/formatter.1SswtO-0.js\",\"_app/immutable/chunks/general.Mrt61Pui.js\",\"_app/immutable/chunks/x.DonkmXk2.js\",\"_app/immutable/chunks/spread.CgU5AtxT.js\",\"_app/immutable/chunks/Icon.CFj6iOEW.js\"];\nexport const stylesheets = [\"_app/immutable/assets/SvelteToast.DbLvtVfH.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}