{"version":3,"file":"request-qZghsHO2.js","sources":["../../../.svelte-kit/adapter-node/chunks/request.js"],"sourcesContent":["import { formatISO } from \"date-fns\";\nimport fs from \"fs\";\nimport crypto from \"crypto\";\nimport { customAlphabet } from \"nanoid\";\nconst BASE_API_URL = \"https://api.kingplay.id/\";\nasync function request({\n  endpoint,\n  method = \"GET\",\n  payload = {},\n  uuid,\n  params\n}) {\n  try {\n    const timestamp = formatISO(/* @__PURE__ */ new Date(), { representation: \"complete\" });\n    const hashedPayload = crypto.createHash(\"sha256\").update(JSON.stringify(payload, null, 0)).digest(\"hex\").toLowerCase();\n    console.log(\"Signature Data\", [method, endpoint, hashedPayload, timestamp].join(\":\"));\n    const stringToSign = [method, endpoint, hashedPayload, timestamp].join(\":\");\n    const privKey = fs.readFileSync(\"./private-key.pem\");\n    const sign = crypto.createSign(\"RSA-SHA256\");\n    sign.update(stringToSign);\n    const signature = sign.sign(privKey, \"base64\");\n    let finalUrl = new URL(endpoint, BASE_API_URL).href;\n    if (params && Object.keys(params).length > 0) {\n      const urlSearchParams = new URLSearchParams();\n      for (const key in params) {\n        if (Object.prototype.hasOwnProperty.call(params, key)) {\n          urlSearchParams.append(key, params[key]);\n        }\n      }\n      finalUrl += `?${urlSearchParams.toString()}`;\n    }\n    const headers = new Headers();\n    headers.append(\"X-TIMESTAMP\", timestamp);\n    headers.append(\"X-SIGNATURE\", signature);\n    headers.append(\"Authorization\", `Bearer ${uuid}`);\n    headers.append(\"Content-Type\", \"application/json\");\n    console.log(\"Request Method\", method);\n    console.log(\"Request URL\", finalUrl);\n    console.log(\"Request Headers\", JSON.stringify(Object.fromEntries(headers)));\n    console.log(\"Request Body\", payload);\n    const opts = { method, headers };\n    if (method === \"POST\") {\n      opts.body = JSON.stringify(payload);\n    }\n    const response = await fetch(finalUrl, opts);\n    console.log(\"Response Status\", response.status, response.statusText);\n    const data = await response.json();\n    console.log(\"Response Data\", JSON.stringify(data));\n    const {\n      response_code: code,\n      response_data: resData,\n      response_message: message,\n      ...additional\n    } = data;\n    return {\n      ok: response.ok,\n      code: code ?? \"\",\n      data: resData,\n      message: message ?? \"\",\n      status: response.status,\n      additional\n    };\n  } catch (error) {\n    console.log(error);\n    return {\n      code: \"XX\",\n      ok: false,\n      status: 500\n    };\n  }\n}\nasync function getClientIp() {\n  const reqIp = await fetch(\"https://api.ipify.org/?format=json\");\n  const resIp = await reqIp.json();\n  return resIp?.ip ?? \"\";\n}\nfunction generateMid(length) {\n  const nanoid = customAlphabet(\"1234567890\", 16);\n  return nanoid();\n}\nexport {\n  BASE_API_URL as B,\n  generateMid as a,\n  getClientIp as g,\n  request as r\n};\n"],"names":["crypto"],"mappings":"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"}